---
title: "CRON job with pg_cron"
description: Schedule PostgreSQL commands directly from the database.
author: dragarcia
github: https://github.com/dragarcia
reference:
  - https://github.com/supabase/supabase/issues/1703
  - https://github.com/citusdata/pg_cron
---

### 0. [*OPTIONAL*] Drop all scheduled jobs and the pg_cron extension itself

This is important if you already have pg_cron enabled and have jobs set

```sql
-- repeat as much to clear all jobs
select cron.unschedule(<job id>);

-- drop the extension
drop extension if exists pg_cron;
```

### 1. Enable pg_cron

```sql
create extension if not exists pg_cron;
```

### 2. [*IMPORTANT*] Provide the following grants to the user postgres (and in the future any other user that would be using the cron schema). At the baseline, it seems pg_cron uses the postgres user when executing its schedule.

```sql
grant usage on schema cron to postgres;
grant all privileges on all tables in schema cron to postgres;
```

### 3. Create sample table test_table

```sql
CREATE TABLE test_table (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  name text
);
```

### 4. Run a CRON job via pg_cron to add a row to this sample table

```sql
select
  cron.schedule(
    'whack-every-minute',
    '* * * * *',
    $$
    insert into test_table(name) values ('kek');
    $$
  );
```
